upstream ingress-nginx {
    server node-0:30080;
    server node-1:30080;
    server node-2:30080;

    keepalive 32;
}

server {
    listen 80         ;
    listen [::]:80    ;

    server_name         .dev.localhost; # match both the exact name "dev.localhost" and the wildcard name "*.dev.localhost". 

    return 308 https://$host:443$request_uri;
}

server {
    listen 443         ssl;
    listen [::]:443    ssl;

    server_name         .dev.localhost;

    ssl_certificate       tls/dev.localhost.crt;
    ssl_certificate_key   tls/dev.localhost.key;

    location / {
        proxy_pass      http://ingress-nginx;

        include proxy_params;
    }
}
